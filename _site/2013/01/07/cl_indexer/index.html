<!DOCTYPE HTML>

<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="author" content="Your Name" />
      <link rel="stylesheet" href="/css/bootstrap/css/bootstrap.css">
      <link rel="stylesheet" href="/css/pygments.css">
      <style type='text/css'>
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .brand {
        font-family: Open Sans;
      }
      .nav {
        font-size: 1.1em;
      }
      .footer {
        position: relative; 
        bottom: 0; 
        left: 0; 
        width: 100%; 
        text-align: center;
      }
      </style>
      <link rel="stylesheet" href="/css/bootstrap/css/bootstrap-responsive.css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <script type="text/javascript">
    //google analytics
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37478382-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

</script>
    <title>Craigslist Indexer</title>
  </head>
<body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">Julie Swoope   </a>
          <div class="nav-collapse">
          <ul class="nav">
          <li><a href="/about.html">About</a></li>
          <li><a href="/projects.html">Projects</a></li>
          <li><a href="/archive.html">Archive</a></li>
          <li><a href="http://github.com/swoopej">Github</a></li>
        </div>
      </div>
    </div>
  </div>


  <div class="row"><br>
  <div class="span8 offset2">
    <div class="content">
      <body>
<div class="post">
    <h1></h1>
    <p><h1>Craigslist Indexer</h1>

<p>My first larger project at Hacker School was <a href="http://github.com/swoopej/cl_indexer" title="Craigslist Indexer">Craigslist Indexer</a>, which is an app to scrape the Craigslist housing listings.  With a lot of other websites, this wouldn't be a 2-3 week project, but Craigslist has no API and a poorly formatted RSS feed, so aggregation isn't easy.  Here is a sample listing from the Craigslist feed:</p>

<div class="highlight"><pre><code class="html">    <span class="nt">&lt;item</span> <span class="na">rdf:about=</span><span class="s">&quot;http://newyork.craigslist.org/brk/abo/3396723906.html&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">&lt;![CDATA[* HOT 3 BR * NEW* CLOSE TO J M Z TRAINS* GREAT BLOCK * E. WILLIAMSBURG (E. WilliamsBurg / Bushwick JMZ ) $2200 3bd]]&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link&gt;</span>http://newyork.craigslist.org/brk/abo/3396723906.html<span class="nt">&lt;/link&gt;</span>
    <span class="nt">&lt;description&gt;</span><span class="cp">&lt;![CDATA[Brand new apartment ! Will be finished by DEC 1st </span>
<span class="cp">    Close by trains J M Z </span>
<span class="cp">    Beautiful tree line block. As well it is quiet! </span>
<span class="cp">    WELL MAINTAINED building ... Kept CLEAN and KEPT at all times !!!! </span>
<span class="cp">    The APARTMENT has nice high ceilings *** </span>
<span class="cp">    Large Closets ..  [...]]]&gt;</span><span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;dc:date&gt;</span>2012-11-26T12:22:02-05:00<span class="nt">&lt;/dc:date&gt;</span>
    <span class="nt">&lt;dc:language&gt;</span>en-us<span class="nt">&lt;/dc:language&gt;</span>
    <span class="nt">&lt;dc:rights&gt;</span>Copyright <span class="ni">&amp;#x26;</span>copy; 2012 craigslist, inc.<span class="nt">&lt;/dc:rights&gt;</span>
    <span class="nt">&lt;dc:source&gt;</span>http://newyork.craigslist.org/brk/abo/3396723906.html<span class="nt">&lt;/dc:source&gt;</span>
    <span class="nt">&lt;dc:title&gt;</span><span class="cp">&lt;![CDATA[* HOT 3 BR * NEW* CLOSE TO J M Z TRAINS* GREAT BLOCK * E. WILLIAMSBURG (E. WilliamsBurg / Bushwick JMZ ) $2200 3bd]]&gt;</span><span class="nt">&lt;/dc:title&gt;</span>
    <span class="nt">&lt;dc:type&gt;</span>text<span class="nt">&lt;/dc:type&gt;</span>
    <span class="nt">&lt;dcterms:issued&gt;</span>2012-11-26T12:22:02-05:00<span class="nt">&lt;/dcterms:issued&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
    
</code></pre></div>


<p>Most of the information that I wanted, i.e. neighborhood, price, and bedrooms, are actually contained in the same title tag, with other delineation to separate them.  The only consistent structures are 1) parentheses around the neighborhood, 2) a dollar sign before the price, and 3) the bedrooms are a digit followed by "bd".</p>

<p>Fortunately, the neighborhood, price, and bedrooms appear in that order, so I did a couple of things.  Before looking for any of the key data, I got the string from within the title tag and found the last occurrence of an open parentheses.  Craigslist allows you to put all the parentheses you want in the user created title, but the last open paren will be the one containing the neighborhood.</p>

<p>The neighborhood description can contain dollar signs, however, so I again had to use Python's rfind method to find the last dollar sign in the already shortened string.I used this index to find both the price and the bedroom, and toss the listing if the correct information isn't found.</p>

<p>The other issue with Craigslist is that almost all of the data is user created, so there is no uniform way of delineating neighborhoods or even spelling certain neighborhoods.  A lot of landlords will fudge the boundaries of neighborhoods by saying that a listing is "Prospect Heights/Crown Heights" when the actual location is the other edge of Crown Heights near Brownsville.</p>

<p>I can't help the fact that some landlords will outright lie about location, because those people often won't include exact addresses or map links, but I did account for hybrid neighborhood listings that include two neighborhoods.  I did this by separating out neighborhoods into its own database table and having a listing-to-neighborhood table that has relations between listings and neighborhoods.  If more than one neighborhood is found in the title listing, multiple relations are inserted into the table.</p>

<p>To solve the problem of spelling different neighborhoods, I just used a dictionary with correct spellings as the key and incorrect spellings as the values.  My parser looks for all the values in the Craigslist data and if a match is found, the key for that value is used for the database entry.</p>

<p>After some refactoring with Zach, one of our facilitators at Hacker School, I was able to get a decently robust parser for the messy data.  I built a fairly simple front end using Flask that just returns JSON, but I'm hoping to add some visualization using Javascript soon.</p>
</p>
</div>
</div>
</body>





    </div>
  </div>
</div>
    <div class="row"><br>
    <div class="span12 offset2"><br>
        <div class="footer">
            <p>   Created with <a href="https://github.com/mojombo/jekyll">Jekyll</a> and <a href="http://twitter.github.com/bootstrap/">Bootstrap</p>
        </div> <!-- close footer -->
        </div>
    </div>

    </body>
</html>

