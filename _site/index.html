<!DOCTYPE HTML>

<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="author" content="Your Name" />
      <link rel="stylesheet" href="/css/bootstrap/css/bootstrap.css">
      <link rel="stylesheet" href="/css/pygments.css">
      <style type='text/css'>
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .brand {
        font-family: Open Sans;
      }
      .nav {
        font-size: 1.1em;
      }
      .footer {
        position: relative; 
        bottom: 0; 
        left: 0; 
        width: 100%; 
        text-align: center;
      }
      </style>
      <link rel="stylesheet" href="/css/bootstrap/css/bootstrap-responsive.css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <script type="text/javascript">
    //google analytics
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37478382-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

</script>
    <title>Welcome</title>
  </head>
<body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">Julie Swoope   </a>
          <div class="nav-collapse">
          <ul class="nav">
          <li><a href="/about.html">About</a></li>
          <li><a href="/projects.html">Projects</a></li>
          <li><a href="/archive.html">Archive</a></li>
          <li><a href="http://github.com/swoopej">Github</a></li>
        </div>
      </div>
    </div>
  </div>


  <div class="row"><br>
  <div class="span8 offset2">
    <div class="content">
      <div class="content">
  <div class="related">
    <ul>
      
      <li>
	January 13, 2013<br>
	<h1>libjpeg, PIL, and OSX</h1>

<p>A few months ago I started to build a Django project that would allow users to upload images.  Seemed like a simple and common thing to build, but I ran into some apparently often encountered problems with libjpeg and the Python Imaging Library (PIL).  At the time, I remeber going through the multitude of Stack Overflow answers and not having any luck.  There is a lot of variations on a similar approach that involves installing libjpeg before you install PIL, then editing the setup.py file in PIL to change the JPEG_ROOT variable.</p>

<p>I finally found a solution that works for me on Mac OSX 10.7.5 here at <a href="http://proteus-tech.com/blog/cwt/install-pil-in-snow-leopard/" title="proteus tech">proteus-tech</a> via Michael Richardson's <a href="http://mtrichardson.com/2009/11/pil-libjpeg-snow-leopard-and-missing-_jpeg_resync_to_restart/" title="Michael Richardson">blog</a> (which has some other suggestions).  I think the previous answers that I found were lacking configuration step of libjpeg and jumping right to installing PIL.  So, add this to the chorus of answers that have worked for different people.</p>

      </li>
      <br>
      <hr>
      <br>
      
      <li>
	January 10, 2013<br>
	<h1>Craigslist Indexer Addendum</h1>

<p>I should add something to the Craigslist Indexer <a href="/2013/01/07/cl_indexer/" title="Craigslist Indexer">post below</a>, because I just pushed some changes today that were glossed over in my previous post, and I think it's something that I (and perhaps others?) seem to do regularly.</p>

<p>The setup:  I have a function that will be passed in a string, and I want it to be able to return a list of the neighborhood names that appear in that string, whether it be a singleton list or a three item list.</p>

<p>I originally wrote the scraper with the neighborhood names that I was searching for in a list.  That is, I had a list of ['DUMBO', 'Fort Greene'...].  This worked fine, and with the help of Hacker School, I had an awesomely short list comprehension that did ran through the list, checked the string for both uppercase and lowercase versions of the string, and returned a list of the names that appear.  This was the whole function:</p>

<pre><code>def find_nabe(item):
    return [x for x in NEIGHBORHOOD_LIST if any(item.find(y) != -1 for y in [x, x.lower(), x.upper()])]
</code></pre>

<p>But the problem, which I mentioned below, is that there are a lot of misspellings on Craigslist and a lot of different ways to refer to a neighborhood (i.e. Bed-Stuy, BedStuy, Bedford-Stuyvesant).  So I made a dictionary that has one key spelling for each neighborhood mapped to all of the possible spellings I want to look for.  I only want to store the key in my database, so I need the function to return the key when it finds one of the values.  I still need the function to return a list, even if it is a singleton list, to keep the ability to have a one Craigslist listing be associated with multiple neighborhoods in my database.</p>

<p>It's not that difficult of a problem, but I struggled with it for a day or so because I was trying to replicate something slick like the list comprehension above.  But a friend of mine pointed out that the length of the list comprehension was getting long, and it was actually much easier to understand simple nested loops.  So, I just broke part of the looping out to it's own function, and came up with this (keep in mind NEIGHBORHOOD_LIST is now a dictionary, and it was a list above):</p>

<div class="highlight"><pre><code class="python">    <span class="k">def</span> <span class="nf">find_nabe</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="n">nabes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">NEIGHBORHOOD_LIST</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">newnabe</span> <span class="o">=</span> <span class="p">(</span><span class="n">check_spellings</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">newnabe</span><span class="p">:</span> <span class="n">nabes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newnabe</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nabes</span>

    <span class="k">def</span> <span class="nf">check_spellings</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
            <span class="n">nabes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span><span class="n">value</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">()]):</span>
                    <span class="k">return</span> <span class="n">k</span>
    
</code></pre></div>


<p>It's eleven lines of code where I used to have two, but it's probably a lot easier to understand and debug than trying to pack this all into a list comprehension.  And speed isn't really an issue here...This is just a script to populate the database.</p>

<p>I think I was falling into a trap of trying to replicate the one liner for the simple reason of writing slick code.  I've found myself doing this a few times, especially as a I try to make my programs more functional in style.  But I'm gradually coming to the realization that 1) I can always go back and refactor this into a more functional style if I want, and 2) functional style isn't always the best or easiest to understand.</p>

      </li>
      <br>
      <hr>
      <br>
      
      <li>
	January  7, 2013<br>
	<h1>Craigslist Indexer</h1>

<p>My first larger project at Hacker School was <a href="http://github.com/swoopej/cl_indexer" title="Craigslist Indexer">Craigslist Indexer</a>, which is an app to scrape the Craigslist housing listings.  With a lot of other websites, this wouldn't be a 2-3 week project, but Craigslist has no API and a poorly formatted RSS feed, so aggregation isn't easy.  Here is a sample listing from the Craigslist feed:</p>

<div class="highlight"><pre><code class="html">    <span class="nt">&lt;item</span> <span class="na">rdf:about=</span><span class="s">&quot;http://newyork.craigslist.org/brk/abo/3396723906.html&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">&lt;![CDATA[* HOT 3 BR * NEW* CLOSE TO J M Z TRAINS* GREAT BLOCK * E. WILLIAMSBURG (E. WilliamsBurg / Bushwick JMZ ) $2200 3bd]]&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link&gt;</span>http://newyork.craigslist.org/brk/abo/3396723906.html<span class="nt">&lt;/link&gt;</span>
    <span class="nt">&lt;description&gt;</span><span class="cp">&lt;![CDATA[Brand new apartment ! Will be finished by DEC 1st </span>
<span class="cp">    Close by trains J M Z </span>
<span class="cp">    Beautiful tree line block. As well it is quiet! </span>
<span class="cp">    WELL MAINTAINED building ... Kept CLEAN and KEPT at all times !!!! </span>
<span class="cp">    The APARTMENT has nice high ceilings *** </span>
<span class="cp">    Large Closets ..  [...]]]&gt;</span><span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;dc:date&gt;</span>2012-11-26T12:22:02-05:00<span class="nt">&lt;/dc:date&gt;</span>
    <span class="nt">&lt;dc:language&gt;</span>en-us<span class="nt">&lt;/dc:language&gt;</span>
    <span class="nt">&lt;dc:rights&gt;</span>Copyright <span class="ni">&amp;#x26;</span>copy; 2012 craigslist, inc.<span class="nt">&lt;/dc:rights&gt;</span>
    <span class="nt">&lt;dc:source&gt;</span>http://newyork.craigslist.org/brk/abo/3396723906.html<span class="nt">&lt;/dc:source&gt;</span>
    <span class="nt">&lt;dc:title&gt;</span><span class="cp">&lt;![CDATA[* HOT 3 BR * NEW* CLOSE TO J M Z TRAINS* GREAT BLOCK * E. WILLIAMSBURG (E. WilliamsBurg / Bushwick JMZ ) $2200 3bd]]&gt;</span><span class="nt">&lt;/dc:title&gt;</span>
    <span class="nt">&lt;dc:type&gt;</span>text<span class="nt">&lt;/dc:type&gt;</span>
    <span class="nt">&lt;dcterms:issued&gt;</span>2012-11-26T12:22:02-05:00<span class="nt">&lt;/dcterms:issued&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
    
</code></pre></div>


<p>Most of the information that I wanted, i.e. neighborhood, price, and bedrooms, are actually contained in the same title tag, with other delineation to separate them.  The only consistent structures are 1) parentheses around the neighborhood, 2) a dollar sign before the price, and 3) the bedrooms are a digit followed by "bd".</p>

<p>Fortunately, the neighborhood, price, and bedrooms appear in that order, so I did a couple of things.  Before looking for any of the key data, I got the string from within the title tag and found the last occurrence of an open parentheses.  Craigslist allows you to put all the parentheses you want in the user created title, but the last open paren will be the one containing the neighborhood.</p>

<p>The neighborhood description can contain dollar signs, however, so I again had to use Python's rfind method to find the last dollar sign in the already shortened string.I used this index to find both the price and the bedroom, and toss the listing if the correct information isn't found.</p>

<p>The other issue with Craigslist is that almost all of the data is user created, so there is no uniform way of delineating neighborhoods or even spelling certain neighborhoods.  A lot of landlords will fudge the boundaries of neighborhoods by saying that a listing is "Prospect Heights/Crown Heights" when the actual location is the other edge of Crown Heights near Brownsville.</p>

<p>I can't help the fact that some landlords will outright lie about location, because those people often won't include exact addresses or map links, but I did account for hybrid neighborhood listings that include two neighborhoods.  I did this by separating out neighborhoods into its own database table and having a listing-to-neighborhood table that has relations between listings and neighborhoods.  If more than one neighborhood is found in the title listing, multiple relations are inserted into the table.</p>

<p>To solve the problem of spelling different neighborhoods, I just used a dictionary with correct spellings as the key and incorrect spellings as the values.  My parser looks for all the values in the Craigslist data and if a match is found, the key for that value is used for the database entry.</p>

<p>After some refactoring with Zach, one of our facilitators at Hacker School, I was able to get a decently robust parser for the messy data.  I built a fairly simple front end using Flask that just returns JSON, but I'm hoping to add some visualization using Javascript soon.</p>

      </li>
      <br>
      <hr>
      <br>
      
      <li>
	January  4, 2013<br>
	<h1>Canteen</h1>

<p>I wanted to write a reflection on the work that I have done so far on <a href="https://github.com/swoopej/canteen" title="Canteen">Canteen</a>, a web framework that I have been working on building from scratch at Hacker School.  I should add up front that not all of the work is mine, I've been working with fellow Hacker Schooler <a href="https://github.com/angusb" title="Angus Github">Angus Burton</a>, and he's certainly helped in ways that I couldn't have done myself.</p>

<p>So the first thing that I learned about is the Web Server Gateway Interface, or WSGI.  I had seen this abbreviation before in the configuration file for Django apps, but it sounded pretty opaque, and I knew that I didn't have to change the default to make my app work, so I occupied myself with other things.</p>

<p>It turns out WSGI is hardly complicated.  It's just a way for the server and the framework or application to communicate, and it's much less complicated form of communication than something like HTTP, which is a protocol that has to be compatible across many platforms.  WSGI only applies to Python servers and Python apps, so the scope is limited and concise.</p>

<p>The gist of it is that a WSGI server will call a WSGI app with two variables when it receives a request.  One is an <a href="http://www.python.org/dev/peps/pep-0333/#environ-variables" title="#environ">environment dictionary</a> containing information about the request and the server environment, and the other is a function that must be called by the WSGI framework to start the response on the server.  It's really remarkably simple.  So a simple WSGI app using the Python Standard Library WSGI server looks something like this:</p>

<div class="highlight"><pre><code class="python">    <span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="kn">import</span> <span class="n">make_server</span>

    <span class="k">class</span> <span class="nc">Canteen</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">run_server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#instantiate the wsgi server</span>
        <span class="c">#receives request, passes to wsgi app</span>
        <span class="c">#send app&#39;s response to client</span>
        <span class="n">httpd</span> <span class="o">=</span> <span class="n">make_server</span><span class="p">(</span>
            <span class="s">&#39;localhost&#39;</span><span class="p">,</span> 
            <span class="mi">8051</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wsgi_app</span> <span class="c">#calls the WSGI app</span>
            <span class="p">)</span>

        <span class="k">def</span> <span class="nf">wsgi_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            called by the server with the environ dict and the start_response function</span>

<span class="sd">            start_response must be called to start the http response.  </span>

<span class="sd">            This function will</span>
<span class="sd">            return the response body as an iterable.</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">response</span> <span class="n">body</span> <span class="o">=</span> <span class="s">&#39;yolo&#39;</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s">&#39;200 OK&#39;</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;Content_Type&#39;</span><span class="p">,</span> <span class="s">&#39;text/html&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;Content_Length&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">response_body</span><span class="p">)))]</span>
            <span class="n">start_response</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">response_headers</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">response_body</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">Canteen</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">()</span>

    
</code></pre></div>


<p>And that's it.  Run that on your local machine, and you will be told that you only live once when you go to port 8051.</p>

<p>The second thing I'll talk about in this post is how we built the interface to our framework, which is nearly identical to that of Flask, another Python framework (side note here:  after digging around in the Flask code for days, it is, in the words of Angus, "quite slick").</p>

<p>I've built a few small apps in Flask, and it's awesome how quickly you can get an app running.  To add a url to your app in Flask, all it takes is this:</p>

<div class="highlight"><pre><code class="python">    <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">()</span>

    <span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
        <span class="n">render_template</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">html</span><span class="p">)</span>
    
</code></pre></div>


<p>and we managed to copy the same syntax (minus the render_template method for now).  Here's how we did it:</p>

<div class="highlight"><pre><code class="python">    <span class="k">def</span> <span class="nf">add_route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span> <span class="s">&#39;GET&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;decorates a user supplied function by adding path to self.routes&#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">Route</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">methods</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">decorator</span>
    
</code></pre></div>


<p>The decorator creates a new Route object and stores the path, the valid HTTP methods, and the function to be called on the Route object.  That new object is added to the list of Route objects at self.routes, and the decorator function is returned.  When a new HTTP request comes in, framework will go through the Route objects, find the right one, and call the function stored on that objects.  If it doesn't find the right one, you get a 404.</p>

<p>I'll talk about how we search for the correct route object in another post, but I wanted to chime and praise Flask again for how lightweight it is.  While starting an app in Django takes at least five different files, you can import Flask into one file and get quite a bit of functionality out of it.  That's what I hope to reproduce with Canteen.</p>

      </li>
      <br>
      <hr>
      <br>
      
    </ul>
  </div>
</div>

    </div>
  </div>
</div>
    <div class="row"><br>
    <div class="span12 offset2"><br>
        <div class="footer">
            <p>   Created with <a href="https://github.com/mojombo/jekyll">Jekyll</a> and <a href="http://twitter.github.com/bootstrap/">Bootstrap</p>
        </div> <!-- close footer -->
        </div>
    </div>

    </body>
</html>

